---
phase: 01-foundation
plan: 04
type: execute
wave: 3
depends_on: ["01-03"]
files_modified:
  - src/app/page.tsx
  - src/app/archive/page.tsx
  - src/components/home/hero-cta.tsx
  - src/components/home/latest-report.tsx
  - src/components/archive/archive-grid.tsx
  - src/components/archive/report-card.tsx
  - src/components/archive/search-input.tsx
  - src/components/archive/category-filter.tsx
  - src/components/ui/badge.tsx
autonomous: true

must_haves:
  truths:
    - "User can visit home page and see latest published report (or hero CTA if none)"
    - "User can click through to read the full latest report"
    - "User can visit /archive and see all published reports in a grid"
    - "User can search reports by typing and see instant filtered results"
    - "User can filter reports by clicking category chips"
    - "Reports are grouped by month with section headers"
    - "Archive layout is responsive (grid on desktop, single column on mobile)"
    - "Empty state shows when no reports match search/filter"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Home page with latest report or hero CTA"
      contains: "LatestReport"
    - path: "src/app/archive/page.tsx"
      provides: "Archive page with search, filter, and grouped grid"
      contains: "ArchiveGrid"
    - path: "src/components/archive/search-input.tsx"
      provides: "Debounced search input synced to URL"
      contains: "useDebouncedCallback"
    - path: "src/components/archive/category-filter.tsx"
      provides: "Category filter chips"
      contains: "searchParams"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/lib/supabase/server.ts"
      via: "createClient for latest report query"
      pattern: "createClient\\(\\)"
    - from: "src/app/archive/page.tsx"
      to: "URL searchParams"
      via: "Server component reading search params for filtering"
      pattern: "searchParams"
    - from: "src/components/archive/report-card.tsx"
      to: "/report/[slug]"
      via: "Link to report detail page"
      pattern: "href=.*report/"
---

<objective>
Build the home page (displaying latest report or hero CTA) and archive page (searchable, filterable grid of all reports grouped by month).

Purpose: These are the entry points for readers to discover and browse content. Home page showcases the latest work; archive enables exploration.

Output: Fully functional home and archive pages with client-side search, category filtering, and responsive layouts.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

Reference CONTEXT.md for:
- Card grid layout for archive
- No excerpt preview on cards (just title, date, category)
- Instant filter search
- Filter chips for categories

Reference RESEARCH.md for:
- Pattern 5: Client-Side Search with URL State
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install debounce dependency and create shared components</name>
  <files>
    package.json
    src/components/ui/badge.tsx
    src/components/archive/report-card.tsx
  </files>
  <action>
Install debounce utility:
```bash
npm install use-debounce
```

Add shadcn badge component:
```bash
npx shadcn@latest add badge
```

Create report card component (`src/components/archive/report-card.tsx`):
- Props: report object with title, slug, category name, publishedAt
- Card with subtle border and hover effect
- Title as primary text (font-playfair, truncate if needed)
- Meta line: formatted date, category badge
- Category badge uses bg-primary/20 text-primary styling
- Entire card is clickable link to /report/[slug]
- No excerpt/preview text (per CONTEXT.md decision)

Card styling:
- bg-card border border-border/50 rounded-lg
- p-6 for padding
- hover:border-primary/50 transition for hover effect
- group class for link hover effects
  </action>
  <verify>
    - use-debounce in package.json dependencies
    - src/components/ui/badge.tsx exists (from shadcn)
    - src/components/archive/report-card.tsx exists
    - `npm run build` succeeds
  </verify>
  <done>Shared components ready for archive and home pages</done>
</task>

<task type="auto">
  <name>Task 2: Create archive page with search and category filtering</name>
  <files>
    src/app/archive/page.tsx
    src/components/archive/archive-grid.tsx
    src/components/archive/search-input.tsx
    src/components/archive/category-filter.tsx
  </files>
  <action>
Create search input (`src/components/archive/search-input.tsx`):
- Client component ("use client")
- Uses useSearchParams, usePathname, useRouter from next/navigation
- Uses useDebouncedCallback from use-debounce (300ms delay)
- Input updates URL with ?q= parameter
- Styled input: bg-background border border-border rounded-md, gold focus ring
- Placeholder: "Search reports..."
- Clears q param when input is empty

Create category filter (`src/components/archive/category-filter.tsx`):
- Client component
- Props: categories array, selectedCategory (from URL)
- Displays category chips/badges in a horizontal flex row
- "All" chip for clearing filter
- Clicking chip updates URL with ?category= parameter
- Selected chip: bg-primary text-primary-foreground
- Unselected chip: bg-muted hover:bg-muted/80
- Preserve other params (q) when updating category

Create archive grid (`src/components/archive/archive-grid.tsx`):
- Server component (receives filtered data from page)
- Props: reports array grouped by month
- For each month group:
  - Month header (e.g., "January 2026") with font-playfair text-xl
  - Grid of ReportCards: grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6
- Empty state: "No reports found" centered text when array is empty

Create archive page (`src/app/archive/page.tsx`):
- Server component
- Read searchParams for q (search) and category (filter)
- Fetch all published reports from Supabase
- Join with categories to get category names
- Client-side filtering logic (or use SQL ILIKE for search):
  - If q param: filter where title or content contains search term (case-insensitive)
  - If category param: filter where category matches
- Group results by month/year (use publishedAt)
- Fetch all categories for the filter chips
- Layout:
  - Page title "Archive" with font-playfair
  - Search input and category filter row
  - Archive grid below

Metadata:
- title: "Archive | The Daily Deep"
- description: "Browse all published investigative reports"
  </action>
  <verify>
    - /archive route exists and builds
    - Search and category components are client components
    - Archive page is server component
    - URL params update when interacting with search/filter
    - `npm run build` succeeds
  </verify>
  <done>Archive page complete with search, category filtering, and grouped grid</done>
</task>

<task type="auto">
  <name>Task 3: Create home page with latest report or hero CTA</name>
  <files>
    src/app/page.tsx
    src/components/home/hero-cta.tsx
    src/components/home/latest-report.tsx
  </files>
  <action>
Create hero CTA component (`src/components/home/hero-cta.tsx`):
- Displayed when no published reports exist
- Centered layout with branding
- "The Daily Deep" title in font-playfair, large
- Tagline: "Premium AI-powered investigative reports published daily"
- Optional: Link to archive (or just branding for now)
- Minimal, elegant styling fitting the editorial aesthetic

Create latest report component (`src/components/home/latest-report.tsx`):
- Props: report object with all fields needed for preview
- Large featured display of the latest report
- Title in font-playfair, very large (text-4xl or text-5xl)
- Subtitle if present
- Meta: category badge, date, reading time
- Summary/excerpt (first ~200 chars of summary or content)
- "Read Report" button/link to /report/[slug]
- Button: bg-primary text-primary-foreground hover:bg-primary/90

Home page layout (`src/app/page.tsx`):
- Server component
- Query: Get the single most recent published report (ORDER BY published_at DESC LIMIT 1)
- Join with categories for category name
- Conditional rendering:
  - If report exists: render LatestReport component
  - If no reports: render HeroCTA component
- Page padding and max-width container

Metadata:
- title: "The Daily Deep | Premium Investigative Reports"
- description: "AI-powered investigative reports covering geopolitics, economics, technology, climate, and more. Published daily."
  </action>
  <verify>
    - Home page (/) renders without errors
    - Shows HeroCTA when database has no published reports
    - Shows LatestReport when at least one published report exists
    - Link to /report/[slug] works from latest report
    - `npm run build` succeeds
  </verify>
  <done>Home page complete with conditional latest report or hero CTA display</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Build succeeds:** `npm run build` completes without errors
2. **Routes exist:**
   - / (home page)
   - /archive
3. **Components render:** No TypeScript errors in any component

**Manual testing scenarios:**

**Empty database (no published reports):**
- Home page shows HeroCTA with branding
- Archive page shows empty state message
- Search and filters still work (just show no results)

**With sample data (at least 2-3 published reports across different months/categories):**
- Home page shows the most recent published report
- Clicking "Read Report" navigates to /report/[slug]
- Archive shows all reports in a grid grouped by month
- Typing in search filters results as you type (with debounce)
- Clicking category chips filters to that category
- Clearing search/filter shows all reports again
- URL updates reflect current search/filter state
- Refreshing with URL params preserves search/filter
- Mobile view shows single column layout
- Desktop shows 2-3 column grid
</verification>

<success_criteria>
- Home page displays latest published report prominently
- Home page shows hero CTA when no reports exist
- "Read Report" link navigates to report detail page
- Archive page displays all published reports in responsive grid
- Search filters reports by title/content with instant results
- Category chips filter reports by category
- Reports are grouped by month with visible section headers
- Empty state displays when no reports match search/filter criteria
- URL state preserves search and filter parameters
- Layout is responsive (grid columns adapt to screen size)
- All pages have appropriate metadata for SEO
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`
</output>
