---
phase: 02-generation-engine
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/admin/(dashboard)/page.tsx
  - src/app/admin/(dashboard)/reports/page.tsx
  - src/app/api/admin/reports/route.ts
  - src/app/api/admin/reports/[id]/route.ts
  - src/components/admin/stats-cards.tsx
  - src/components/admin/report-list.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard shows total reports count"
    - "Dashboard shows reports published this month"
    - "Dashboard shows latest publish date"
    - "Dashboard shows today's category prominently"
    - "Report list shows status badges (draft, published, generating, failed)"
    - "Admin can delete a report from the list"
  artifacts:
    - path: "src/app/admin/(dashboard)/page.tsx"
      provides: "Dashboard with stats and category display"
      min_lines: 40
    - path: "src/app/admin/(dashboard)/reports/page.tsx"
      provides: "Report management page"
      min_lines: 30
    - path: "src/app/api/admin/reports/route.ts"
      provides: "GET reports list"
      exports: ["GET"]
    - path: "src/app/api/admin/reports/[id]/route.ts"
      provides: "DELETE report"
      exports: ["DELETE"]
    - path: "src/components/admin/stats-cards.tsx"
      provides: "Stats display component"
      exports: ["StatsCards"]
    - path: "src/components/admin/report-list.tsx"
      provides: "Report list with actions"
      exports: ["ReportList"]
  key_links:
    - from: "src/app/admin/(dashboard)/page.tsx"
      to: "/api/admin/reports"
      via: "stats query"
      pattern: "supabase.*reports"
    - from: "src/components/admin/report-list.tsx"
      to: "/api/admin/reports/[id]"
      via: "delete button"
      pattern: "DELETE.*reports"
---

<objective>
Create the admin dashboard with stats display, today's category, and report management list with delete functionality.

Purpose: Admin needs visibility into reports and ability to manage published content. This provides the management interface before adding generation trigger (Plan 02-04).

Output: Dashboard page with stats cards, report list page with status badges and delete action.
</objective>

<execution_context>
@/Users/matanbenhaim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matanbenhaim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-generation-engine/02-CONTEXT.md

@src/app/admin/(dashboard)/layout.tsx
@src/lib/admin/auth.ts
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create dashboard stats and category display</name>
  <files>
    src/components/admin/stats-cards.tsx
    src/app/admin/(dashboard)/page.tsx
  </files>
  <action>
1. Create `src/components/admin/stats-cards.tsx`:
   - Server component (fetches data directly)
   - Accept props: totalReports, reportsThisMonth, latestPublishDate
   - Display 3 stat cards in a row:
     - Total Reports (number)
     - This Month (number)
     - Latest Publish (formatted date or "None")
   - Style with Tailwind:
     - Grid layout (3 columns on lg, 1 on mobile)
     - Card style with subtle border
     - Gold accent for numbers
     - Dark theme compatible

2. Create/update `src/app/admin/(dashboard)/page.tsx`:
   - Server component
   - Fetch stats from Supabase:
     ```typescript
     // Total reports
     const { count: totalReports } = await supabase
       .from('reports')
       .select('*', { count: 'exact', head: true });

     // Reports this month
     const startOfMonth = new Date();
     startOfMonth.setDate(1);
     startOfMonth.setHours(0, 0, 0, 0);
     const { count: reportsThisMonth } = await supabase
       .from('reports')
       .select('*', { count: 'exact', head: true })
       .gte('published_at', startOfMonth.toISOString())
       .eq('status', 'published');

     // Latest publish date
     const { data: latest } = await supabase
       .from('reports')
       .select('published_at')
       .eq('status', 'published')
       .order('published_at', { ascending: false })
       .limit(1)
       .single();
     ```
   - Fetch today's category:
     ```typescript
     const dayOfWeek = new Date().getDay(); // 0=Sunday
     const { data: category } = await supabase
       .from('categories')
       .select('name')
       .eq('day_of_week', dayOfWeek)
       .single();
     ```
   - Display:
     - "Today is {Category} {DayName}" prominently at top (e.g., "Today is Science Tuesday")
     - StatsCards component below
     - Quick links to Reports and Generate (placeholder for now)
   - Style:
     - Large heading for category
     - Editorial feel consistent with public site
  </action>
  <verify>
    Run dev server, login, visit /admin - dashboard displays with stats and today's category
  </verify>
  <done>
    - Dashboard shows all 3 stats (total, this month, latest date)
    - Today's category displayed prominently
    - Responsive layout
  </done>
</task>

<task type="auto">
  <name>Task 2: Create reports API endpoints</name>
  <files>
    src/app/api/admin/reports/route.ts
    src/app/api/admin/reports/[id]/route.ts
  </files>
  <action>
1. Create `src/app/api/admin/reports/route.ts`:
   - Export GET handler
   - Verify admin using getUser() + ADMIN_EMAIL check
   - Return 401 if not admin
   - Fetch reports with category join:
     ```typescript
     const { data: reports } = await supabase
       .from('reports')
       .select(`
         id,
         title,
         slug,
         status,
         published_at,
         created_at,
         word_count,
         category:categories(name)
       `)
       .order('created_at', { ascending: false });
     ```
   - Return JSON response

2. Create `src/app/api/admin/reports/[id]/route.ts`:
   - Export DELETE handler
   - Verify admin using getUser() + ADMIN_EMAIL check
   - Return 401 if not admin
   - Extract id from params
   - Delete report:
     ```typescript
     const { error } = await supabase
       .from('reports')
       .delete()
       .eq('id', id);
     ```
   - Return 200 on success, 500 on error

IMPORTANT: Always use getUser() for auth validation, not getSession().
  </action>
  <verify>
    TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
    - GET /api/admin/reports returns report list
    - DELETE /api/admin/reports/[id] deletes report
    - Both endpoints verify admin auth
  </done>
</task>

<task type="auto">
  <name>Task 3: Create report list component and page</name>
  <files>
    src/components/admin/report-list.tsx
    src/app/admin/(dashboard)/reports/page.tsx
  </files>
  <action>
1. Create `src/components/admin/report-list.tsx`:
   - 'use client' component (needs interactivity for delete)
   - Props: reports array (from API)
   - Display table/list with columns:
     - Title (link to public report page)
     - Category
     - Status (with colored badge)
     - Published Date
     - Word Count
     - Actions (Delete button)
   - Status badge colors:
     - draft: gray
     - published: green
     - generating: yellow/amber (animated pulse)
     - failed: red
   - Delete button:
     - Confirm dialog before delete
     - Call DELETE /api/admin/reports/[id]
     - Refresh list on success (router.refresh())
   - Style:
     - Dark theme table
     - Hover states on rows
     - Responsive (stack on mobile)

2. Create `src/app/admin/(dashboard)/reports/page.tsx`:
   - Server component
   - Fetch reports via Supabase directly (faster than API call)
   - Pass to ReportList client component
   - Title: "Manage Reports"
   - Empty state if no reports

Use shadcn/ui components if helpful (Button, Table, Badge, AlertDialog).
Run `npx shadcn@latest add button table badge alert-dialog` if needed.
  </action>
  <verify>
    1. Run dev server, login, visit /admin/reports
    2. Report list displays (or empty state if no reports)
    3. Delete button shows confirmation and works
  </verify>
  <done>
    - Report list displays with all columns
    - Status badges show correct colors
    - Delete functionality works with confirmation
    - Empty state handled
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - no TypeScript errors
2. `npm run build` - builds successfully
3. Dashboard shows stats (may be 0/None if no data)
4. Today's category displays correctly
5. Report list page loads
6. Delete API endpoint responds to DELETE request
</verification>

<success_criteria>
- Admin can view dashboard with stats and today's category
- Admin can view list of all reports with status badges
- Admin can delete reports with confirmation
- All admin routes protected
</success_criteria>

<output>
After completion, create `.planning/phases/02-generation-engine/02-03-SUMMARY.md`
</output>
