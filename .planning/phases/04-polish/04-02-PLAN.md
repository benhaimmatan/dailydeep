---
phase: 04-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/seo/json-ld.ts
  - src/app/report/[slug]/page.tsx
  - src/components/report/report-content.tsx
autonomous: true

must_haves:
  truths:
    - "Report pages use semantic HTML structure (article, section, proper headings)"
    - "Reports include JSON-LD Article structured data for rich search results"
    - "Structured data passes Google Rich Results Test validation"
  artifacts:
    - path: "src/lib/seo/json-ld.ts"
      provides: "JSON-LD schema generator helper"
      exports: ["generateArticleJsonLd"]
    - path: "src/app/report/[slug]/page.tsx"
      provides: "Inline JSON-LD script tag"
      contains: "application/ld+json"
    - path: "src/components/report/report-content.tsx"
      provides: "Semantic HTML wrapper"
      contains: "<section"
  key_links:
    - from: "src/app/report/[slug]/page.tsx"
      to: "src/lib/seo/json-ld.ts"
      via: "generateArticleJsonLd import"
      pattern: "import.*generateArticleJsonLd"
    - from: "src/app/report/[slug]/page.tsx"
      to: "JSON-LD script"
      via: "dangerouslySetInnerHTML"
      pattern: "dangerouslySetInnerHTML.*JSON\\.stringify"
---

<objective>
Add semantic HTML structure and JSON-LD Article structured data for rich search results.

Purpose: Enable Google rich results and improve accessibility with proper semantic markup.
Output: Report pages pass structured data validation and use semantic HTML5 elements.
</objective>

<execution_context>
@/Users/matanbenhaim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matanbenhaim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish/04-CONTEXT.md
@.planning/phases/04-polish/04-RESEARCH.md
@src/app/report/[slug]/page.tsx
@src/components/report/report-content.tsx
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install schema-dts and create JSON-LD helper</name>
  <files>src/lib/seo/json-ld.ts</files>
  <action>
    First, install the schema-dts package for TypeScript types:
    ```bash
    npm install schema-dts
    ```

    Create new file `src/lib/seo/json-ld.ts` with a helper function to generate Article JSON-LD:

    ```typescript
    import type { Article, WithContext } from 'schema-dts'
    import type { ReportWithCategory } from '@/types/database'

    const SITE_URL = process.env.NEXT_PUBLIC_SITE_URL || 'https://thedailydeep.com'

    export function generateArticleJsonLd(report: ReportWithCategory): WithContext<Article> {
      return {
        '@context': 'https://schema.org',
        '@type': 'Article',
        headline: report.title,
        description: report.seo_description || report.summary || undefined,
        image: `${SITE_URL}/report/${report.slug}/opengraph-image`,
        datePublished: report.published_at || report.created_at,
        dateModified: report.updated_at,
        author: {
          '@type': 'Organization',
          name: 'The Daily Deep',
          description: 'AI-assisted investigative journalism',
        },
        publisher: {
          '@type': 'Organization',
          name: 'The Daily Deep',
          logo: {
            '@type': 'ImageObject',
            url: `${SITE_URL}/logo.png`,
          },
        },
        wordCount: report.word_count || undefined,
        keywords: report.seo_keywords?.join(', ') || undefined,
        articleSection: report.category?.name || 'News',
        inLanguage: 'en-US',
        mainEntityOfPage: {
          '@type': 'WebPage',
          '@id': `${SITE_URL}/report/${report.slug}`,
        },
      }
    }

    /**
     * Safely stringify JSON-LD for inline script tag
     * Escapes < characters to prevent XSS
     */
    export function safeJsonLdStringify(jsonLd: object): string {
      return JSON.stringify(jsonLd).replace(/</g, '\\u003c')
    }
    ```

    Key decisions:
    - Author is "The Daily Deep" organization (transparent about AI-assisted)
    - Publisher includes logo reference (create placeholder logo.png in public/)
    - wordCount from database field
    - articleSection from category name
    - mainEntityOfPage for canonical reference
  </action>
  <verify>Run `npm run build` - should compile without TypeScript errors</verify>
  <done>JSON-LD helper function created with proper schema.org types</done>
</task>

<task type="auto">
  <name>Task 2: Add JSON-LD script to report page</name>
  <files>src/app/report/[slug]/page.tsx</files>
  <action>
    Import the JSON-LD helper and add inline structured data script to the report page.

    Add imports at top of file:
    ```typescript
    import { generateArticleJsonLd, safeJsonLdStringify } from '@/lib/seo/json-ld'
    ```

    In the ReportPage component, before the return statement, generate the JSON-LD:
    ```typescript
    const jsonLd = generateArticleJsonLd(report)
    ```

    Add the JSON-LD script tag inside the article element, at the very beginning (before the grid div):
    ```tsx
    <article className="max-w-6xl mx-auto px-4 py-8">
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{
          __html: safeJsonLdStringify(jsonLd),
        }}
      />
      <div className="lg:grid lg:grid-cols-[1fr_280px] lg:gap-12">
        ...
      </div>
    </article>
    ```

    The JSON-LD script is invisible to users but crawled by search engines.
    The safeJsonLdStringify function prevents XSS by escaping < characters.
  </action>
  <verify>
    Run `npm run build` - should compile without errors.
    View page source on a report page, confirm application/ld+json script present.
    Use Google Rich Results Test (https://search.google.com/test/rich-results) to validate.
  </verify>
  <done>Report pages include inline JSON-LD Article structured data</done>
</task>

<task type="auto">
  <name>Task 3: Enhance semantic HTML structure</name>
  <files>src/components/report/report-content.tsx</files>
  <action>
    Wrap the markdown content in semantic HTML5 elements for better accessibility and SEO.

    The report content is already inside an <article> tag (from page.tsx). Enhance the content wrapper:

    1. Change the outer div to a <section> element with aria-label:
    ```tsx
    export function ReportContent({ content }: ReportContentProps) {
      return (
        <section className="prose-custom" aria-label="Article content">
          <ReactMarkdown remarkPlugins={[remarkGfm]} components={components}>
            {content}
          </ReactMarkdown>
        </section>
      )
    }
    ```

    2. The existing heading components (h2, h3, h4) already have proper hierarchy - h2 is the first level in content since h1 is reserved for the page title. No changes needed there.

    3. In the components object, ensure tables have proper caption support by wrapping in figure:
    ```typescript
    table: ({ children }) => (
      <figure className="overflow-x-auto my-8">
        <table className="w-full" role="table">{children}</table>
      </figure>
    ),
    ```

    4. Add role="presentation" to decorative elements like hr:
    ```typescript
    hr: () => <hr className="border-border/50 my-8" role="separator" />,
    ```

    Key semantic improvements:
    - Content wrapped in <section> with aria-label
    - Tables wrapped in <figure> for proper grouping
    - Explicit roles where helpful for assistive technology
  </action>
  <verify>
    Run `npm run build` - should compile without errors.
    Use browser accessibility inspector to verify semantic structure.
    Run Lighthouse accessibility audit on a report page - should pass semantic checks.
  </verify>
  <done>Report content uses semantic HTML5 elements with proper ARIA labels</done>
</task>

</tasks>

<verification>
1. Build succeeds: `npm run build` completes without errors
2. JSON-LD validation: Use https://search.google.com/test/rich-results with a report URL
   - Should show Article detected with headline, datePublished, author
   - No critical errors in structured data
3. Semantic HTML: View page source and confirm:
   - Content wrapped in <section> with aria-label
   - JSON-LD script present with @type: Article
4. Accessibility: Run Lighthouse audit, semantic HTML checks should pass
</verification>

<success_criteria>
- Report pages contain valid JSON-LD Article structured data
- Google Rich Results Test shows Article detected without critical errors
- Report content uses semantic <section> element
- Tables have proper semantic grouping
- Build completes without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish/04-02-SUMMARY.md`
</output>
